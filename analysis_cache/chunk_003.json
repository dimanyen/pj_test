{
  "chunk_index": 3,
  "result": "```markdown\n# 檔案區塊分析\n\n## 基本資訊\n- 檔名: MMBNewLoginViewModel.swift\n- 語言: swift\n- 區塊: 3/6\n- 行數: 200\n\n## 函式一覽\n- MMBNewLoginViewModel.saveLoginModelCustomerID() [401-405]\n  - 參數: *none*\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 讀取 `MMBLocalStorageModel.sharedInstance().localStorageLoginModel.customerId`，寫入 `self.loginModel.customerID`\n\n- MMBNewLoginViewModel.processFidoAuth() [408-410]\n  - 參數: *none*\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 呼叫 `self.fidoLoginManager.startAuthentication()`（外部物件）\n\n- MMBNewLoginViewModel.needProcessDeepLink() -> Bool [414-416]\n  - 參數: *none*\n  - 回傳: Bool\n  - 例外: none\n  - 副作用: 讀取 `MMBPushNotificationManager.sharedInstance().payload`（外部）\n\n- MMBNewLoginViewModel.isPasswordStatusError(_ errorModel: MMBErrorModel) -> Bool [421-424]\n  - 參數:\n    - errorModel: MMBErrorModel required\n  - 回傳: Bool\n  - 例外: none\n  - 副作用: 讀取 `errorModel` 及 `loginErrorStatusKey`（屬性），無外部 I/O\n\n- MMBNewLoginViewModel.isPasswordValidateError(_ errorModel: MMBErrorModel) -> Bool [429-432]\n  - 參數:\n    - errorModel: MMBErrorModel required\n  - 回傳: Bool\n  - 例外: none\n  - 副作用: 讀取 `errorModel`，無外部 I/O\n\n- MMBNewLoginViewModel.getPopupContentWithoutVerifyType(_ forceTwoStep: Bool) -> NSAttributedString [437-478]\n  - 參數:\n    - forceTwoStep: Bool required\n  - 回傳: NSAttributedString\n  - 例外: none\n  - 副作用: 建立並組合 `NSMutableAttributedString`、`NSMutableParagraphStyle`、`UIFont`、`UIColor` 等 UI 物件（純本地記憶體操作）\n\n- MMBNewLoginViewModel.fetchLogin() [485-543]\n  - 參數: *none*\n  - 回傳: Void\n  - 例外: none\n  - 副作用:\n    - 發送 loading 狀態 (`self.loadingViewSubject.send`)\n    - 讀寫 `MMBConfigManager.sharedInstance().deviceToken`\n    - 呼叫 `self.serviceMHMOT.requestLogin`（外部服務）\n    - 讀寫 `MMBLocalStorageModel.sharedInstance().loginMethod`\n    - 更新 `MMBDataEngine.sharedInstance().userBankItem.userName`\n    - 呼叫 `MMBFirebaseManager.sharedInstance().sendFireLoginStatus`\n    - 呼叫多個內部方法：`isPasswordStatusError`、`convertToResultModel`、`isNeedCleanAccountAndPwd`、`handleErrorStatus`、`handleValidateError`、`apiStateSubject.send`、`manager.handleLogin`\n\n- MMBNewLoginViewModel.fetchLoginAgain(overWriteDevice: Bool) [547-567]\n  - 參數:\n    - overWriteDevice: Bool required\n  - 回傳: Void\n  - 例外: none\n  - 副作用:\n    - 發送 loading 狀態\n    - 呼叫 `self.serviceMHMOT.requestLoginAgain`\n    - 呼叫內部方法 `savePasswordUpgradeModel`、`saveToDataEngine`\n    - 呼叫 `manager.handleLogin`\n    - 發送 API 錯誤狀態 (`apiStateSubject.send`)\n\n- MMBNewLoginViewModel.fetchFidoQuickLogin() [570-600]\n  - 參數: *none*\n  - 回傳: Void\n  - 例外: none\n  - 副作用:\n    - 設定 `MMBDataEngine.sharedInstance().loggedInStartTime`\n    - 發送 loading 狀態\n    - 讀寫 `MMBConfigManager.sharedInstance().deviceToken`\n    - 呼叫 `self.serviceMHMOT.requestLogin`（FIDO 登入）\n    - 更新 `MMBLocalStorageModel.sharedInstance().loginMethod`\n    - 呼叫 `saveToDataEngine`\n    - 更新 `MMBDataEngine.sharedInstance().userBankItem.userId`\n    - 呼叫 `MMBFirebaseManager.sharedInstance().sendFireLoginStatus`\n\n## 外部相依\n- imports:\n  - none (本區塊未顯示 import 語句)\n\n## 函式關係（區塊內可觀察）\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.isPasswordStatusError (internal)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.convertToResultModel (internal, external/unknown if not in chunk)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.isNeedCleanAccountAndPwd (internal)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.handleErrorStatus (internal)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.handleValidateError (internal)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.apiStateSubject.send (property method, internal)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.manager.handleLogin (external/unknown)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.loadingViewSubject.send (internal)\n- MMBNewLoginViewModel.fetchLogin → MMBNewLoginViewModel.serviceMHMOT.requestLogin (external/unknown)\n\n- MMBNewLoginViewModel.fetchLoginAgain → MMBNewLoginViewModel.savePasswordUpgradeModel (internal)\n- MMBNewLoginViewModel.fetchLoginAgain → MMBNewLoginViewModel.saveToDataEngine (internal)\n- MMBNewLoginViewModel.fetchLoginAgain → MMBNewLoginViewModel.manager.handleLogin (external/unknown)\n- MMBNewLoginViewModel.fetchLoginAgain → MMBNewLoginViewModel.loadingViewSubject.send (internal)\n- MMBNewLoginViewModel.fetchLoginAgain → MMBNewLoginViewModel.serviceMHMOT.requestLoginAgain (external/unknown)\n\n- MMBNewLoginViewModel.fetchFidoQuickLogin → MMBNewLoginViewModel.loadingViewSubject.send (internal)\n- MMBNewLoginViewModel.fetchFidoQuickLogin → MMBNewLoginViewModel.serviceMHMOT.requestLogin (external/unknown)\n- MMBNewLoginViewModel.fetchFidoQuickLogin → MMBNewLoginViewModel.saveToDataEngine (internal)\n- MMBNewLoginViewModel.fetchFidoQuickLogin → MMBNewLoginViewModel.manager.handleLogin (external/unknown) *未在此片段顯示，但在成功回呼中可能呼叫*\n- MMBNewLoginViewModel.fetchFidoQuickLogin → MMBNewLoginViewModel.MMBFirebaseManager.sharedInstance().sendFireLoginStatus (external/unknown)\n\n- MMBNewLoginViewModel.processFidoAuth → self.fidoLoginManager.startAuthentication (external/unknown)\n\n## 摘要\n- 目的: 提供登入相關的業務邏輯，包括一般帳號密碼登入、再次登入、FIDO 快速登入以及相關 UI 文字產生與錯誤判斷。\n- 範圍/邊界: 此區塊僅負責在 ViewModel 層組合請求參數、呼叫服務層 API、處理回傳結果與錯誤，並透過 PublishSubject/Subject 更新 UI 狀態；不直接執行網路或資料持久化的實作細節。\n- 備註（若有重要不確定性）: 內部呼叫的部分如 `convertToResultModel`、`isNeedCleanAccountAndPwd`、`handleErrorStatus`、`handleValidateError`、`savePasswordUpgradeModel`、`saveToDataEngine` 等未在本區塊內定義，屬於外部/未知符號。\n```",
  "timestamp": 1757928576.502766
}