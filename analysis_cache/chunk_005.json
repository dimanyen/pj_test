{
  "chunk_index": 5,
  "result": "```markdown\n# 檔案區塊分析\n\n## 基本資訊\n- 檔名: MMBNewLoginViewModel.swift\n- 語言: swift\n- 區塊: 5/6\n- 行數: 200\n\n## 函式一覽\n- MMBNewLoginViewModel.saveAndLogLocalStorageModel(model: MMBLocalStorageLoginModel, typeString: String) [804-807]\n  - 參數:\n    - model: MMBLocalStorageLoginModel required\n    - typeString: String required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 呼叫 MMBLocalStorageModel.sharedInstance().save、logLoginType（外部 I/O）\n\n- MMBNewLoginViewModel.handleErrorStatus(errorDict: NSDictionary) -> String [812-818]\n  - 參數:\n    - errorDict: NSDictionary required\n  - 回傳: String\n  - 例外: none\n  - 副作用: 可能呼叫 convertToResultModel（內部），使用 errorResultModel.displayErrorMessage.nonHTML（外部）\n\n- MMBNewLoginViewModel.convertToResultModel(errorDict: NSDictionary) -> MMBResultModel? [823-828]\n  - 參數:\n    - errorDict: NSDictionary required\n  - 回傳: MMBResultModel? (optional)\n  - 例外: none\n  - 副作用: 建構 MMBResultModel (外部)\n\n- MMBNewLoginViewModel.handleValidateError(errorType: MMBLoginInputContentType, errorMessage: String) [835-847]\n  - 參數:\n    - errorType: MMBLoginInputContentType required\n    - errorMessage: String required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 更新 self.inputContent 各欄位狀態（UI），呼叫 MMBAdobeAnalyticsLogin().sendLoginPageNewLoginVerifyErrorEvent（外部）\n\n- MMBNewLoginViewModel.saveToDataEngine(bankStatusModel: MMBBankStatusModel) [851-858]\n  - 參數:\n    - bankStatusModel: MMBBankStatusModel required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 寫入 MMBDataEngine.sharedInstance().userBankItem.userName、Account.shared().uid（外部狀態變更）\n\n- MMBNewLoginViewModel.isNeedCleanAccountAndPwd(errorCode: String) -> Bool [862-865]\n  - 參數:\n    - errorCode: String required\n  - 回傳: Bool\n  - 例外: none\n  - 副作用: 讀取 loginErrorCode.allCases（外部）\n\n- MMBNewLoginViewModel.deviceLockLoginAgainConfirmAction(overWriteDevice: Bool) [874-876]\n  - 參數:\n    - overWriteDevice: Bool required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 呼叫 self.fetchLoginAgain(overWriteDevice:)（外部/未知）\n\n- MMBNewLoginViewModel.handleFirstLogin() [879-887]\n  - 參數: none\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 讀取 Account.shared().level，發送 navigationStateSubject 事件（UI/導航）\n\n- MMBNewLoginViewModel.resetLoginData() [890-902]\n  - 參數: none\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 清除 Account.shared().userCustomPhoto，重置本地儲存模型，呼叫 saveAndLogLocalStorageModel（內部），可能寫入本地儲存（外部 I/O）\n\n- MMBNewLoginViewModel.nonOtherDeviceHandle(logString: String) [904-917]\n  - 參數:\n    - logString: String required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 與 resetLoginData 類似，最後呼叫 saveAndLogLocalStorageModel（內部）\n\n- MMBNewLoginViewModel.updateAccountPassword(updateNow: Bool) [921-929]\n  - 參數:\n    - updateNow: Bool required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 若 updateNow，發送 navigationStateSubject 事件；否則呼叫 fetchLoginAgain（外部/未知）\n\n- MMBNewLoginViewModel.loggedInConfirmAction() [932-940]\n  - 參數: none\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 依 loginMethodType 呼叫 fetchLoginAgain 或 fetchQuickLoginAgain（外部/未知）\n\n- MMBNewLoginViewModel.passwordExpired(updateNow: Bool) [944-959]\n  - 參數:\n    - updateNow: Bool required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 若 updateNow，發送 navigationStateSubject 事件；否則調整本地儲存模型、隱藏快速登入按鈕、呼叫 saveAndLogLocalStorageModel，最後 fetchLoginAgain（內外部）\n\n- MMBNewLoginViewModel.loginErrorHandle(loginErrorMessage: String) [962-972]\n  - 參數:\n    - loginErrorMessage: String required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 重置本地儲存模型、呼叫 saveAndLogLocalStorageModel，發送 Adobe 與 Firebase 失敗事件（外部）\n\n- MMBNewLoginViewModel.loginTypeErrorHandle(loginErrorMessage: String) [976-985]\n  - 參數:\n    - loginErrorMessage: String required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 設定 preferredLoginType、隱藏快速登入按鈕、呼叫 saveAndLogLocalStorageModel，發送 Adobe 與 Firebase 失敗事件（外部）\n\n- MMBNewLoginViewModel.maxErrorCountHandle(loginErrorMessage: String) [989-998]\n  - 參數:\n    - loginErrorMessage: String required\n  - 回傳: Void\n  - 例外: none\n  - 副作用: 設定 loginErrCnt、呼叫 saveAndLogLocalStorageModel，發送 Adobe 與 Firebase 失敗事件（外部）\n\n## 外部相依\n- imports: none observed in此區塊\n- 使用的外部類別/單例（依賴來源）:\n  - MMBLocalStorageModel — local / third_party (singleton)\n  - MMBAdobeAnalyticsLogin — local / third_party\n  - MMBDataEngine — local / third_party\n  - Account — local / third_party\n  - MMBAdobeManager — local / third_party\n  - MMBFirebaseManager — local / third_party\n  - navigationStateSubject — 屬於本類別的 Publisher (內部)\n  - self.manager、self.loginModel、self.inputContent 等屬性 — 本類別內部狀態\n\n## 函式關係（區塊內可觀察）\n- saveAndLogLocalStorageModel → MMBLocalStorageModel.sharedInstance().save (external)\n- saveAndLogLocalStorageModel → MMBLocalStorageModel.sharedInstance().logLoginType (external)\n- handleErrorStatus → convertToResultModel (internal)\n- handleValidateError → MMBAdobeAnalyticsLogin().sendLoginPageNewLoginVerifyErrorEvent (external)\n- saveToDataEngine → MMBDataEngine.sharedInstance() (external)\n- saveToDataEngine → Account.shared() (external)\n- deviceLockLoginAgainConfirmAction → fetchLoginAgain (external/unknown)\n- handleFirstLogin → Account.shared() (external)\n- handleFirstLogin → navigationStateSubject.send (internal side‑effect)\n- resetLoginData → Account.shared() (external)\n- resetLoginData → MMBLocalStorageModel.sharedInstance() (external)\n- resetLoginData → saveAndLogLocalStorageModel (internal)\n- nonOtherDeviceHandle → saveAndLogLocalStorageModel (internal)\n- updateAccountPassword → navigationStateSubject.send (internal)\n- updateAccountPassword → fetchLoginAgain (external/unknown)\n- loggedInConfirmAction → fetchLoginAgain / fetchQuickLoginAgain (external/unknown)\n- passwordExpired → navigationStateSubject.send (internal)\n- passwordExpired → saveAndLogLocalStorageModel (internal)\n- passwordExpired → fetchLoginAgain (external/unknown)\n- loginErrorHandle → saveAndLogLocalStorageModel (internal)\n- loginErrorHandle → MMBAdobeManager.sharedInstance().sendLoginFail (external)\n- loginErrorHandle → MMBFirebaseManager.sharedInstance().sendFireLoginStatus (external)\n- loginTypeErrorHandle → saveAndLogLocalStorageModel (internal)\n- loginTypeErrorHandle → MMBAdobeManager.sharedInstance().sendLoginFail (external)\n- loginTypeErrorHandle → MMBFirebaseManager.sharedInstance().sendFireLoginStatus (external)\n- maxErrorCountHandle → saveAndLogLocalStorageModel (internal)\n- maxErrorCountHandle → MMBAdobeManager.sharedInstance().sendLoginFail (external)\n- maxErrorCountHandle → MMBFirebaseManager.sharedInstance().sendFireLoginStatus (external)\n\n## 摘要\n- 目的: 此程式碼區塊實作 MMBNewLoginViewModel 中與登入流程相關的輔助方法，負責本地儲存、錯誤處理、狀態更新與外部分析/追蹤呼叫。\n- 範圍/邊界: 僅處理資料模型的保存、UI 錯誤顯示、以及與 Adobe、Firebase、DataEngine 等外部服務的互動；不包含實際的網路登入請求或 UI 組件本身的實作。\n- 備註（若有重要不確定性）: 依賴的 `fetchLoginAgain`、`fetchQuickLoginAgain`、`navigationStateSubject`、`self.manager` 等在此區塊未定義，視為外部/未知符號。\n```",
  "timestamp": 1757928686.47797
}